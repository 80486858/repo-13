package main

import (
	"log"
	"math"
	"net/http"
	"time"
)

const targetURL = "http://nginx"
const minTPS = 10.0
const maxTPS = 50.0
const period = 30 * time.Minute

func main() {
	const amplitude float64 = (maxTPS - minTPS) / 2.0

	tr := &http.Transport{
		DisableKeepAlives: true,
	}

	client := &http.Client{
		Transport: tr,
		Timeout:   10 * time.Second,
	}

	for {
		go func() {
			resp, err := client.Get(targetURL)
			if err != nil {
				log.Printf("http.Get(%s) -> %s", targetURL, err)
				return
			}
			defer resp.Body.Close()
		}()

		s := math.Sin(2 * math.Pi * float64(time.Now().Unix()) / period.Seconds())
		p := time.Duration(1000000000 / (minTPS + amplitude + amplitude*s))
		time.Sleep(p)
	}
}
